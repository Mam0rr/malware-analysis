

#include <iostream>
#include <windows.h>
#include <tchar.h>

void GetCurrentFilePath(TCHAR* CurrentPath) {

    printf("[*] Getting the current file path...\n");

    int CurrentPathSize = GetModuleFileName(NULL, CurrentPath, MAX_PATH);

    if (CurrentPathSize < 1) 
    {
        printf("[-] Failed to get the current file path\n");
        exit(EXIT_FAILURE);
    }

    printf("[+] Current file path found\n");

}


void ConstructNewFilePath(TCHAR* CurrentPath, TCHAR* NewPath)
{
    printf("[*] Cloning the current file name... \n");
    
    TCHAR* CurrentFileName = _tcsrchr(CurrentPath, '\\') + 1;

    if (CurrentFileName == NULL) 
    {
        printf("[-] Failed to clone the current file name\n");
        exit(EXIT_FAILURE);
    }
    else
    {
        printf("[+] current file name cloned\n");
    }

    printf("[*] Generating new file name... \n");

    int NewPathLength = swprintf_s(NewPath, MAX_PATH, _T("%s\\%s"), _T("C:\\path\\to\\destination\\directory"), CurrentFileName);

    if (NewPathLength < 1)
    {
        printf("[-] Failed to generate new file name\n");
        exit(EXIT_FAILURE);
    }

    printf("[+] New file name generated successfully\n");
}


void CopyFileToDestination(TCHAR* CurrentPath, TCHAR* NewPath) 
{
    printf("[*] Copying file to destination... \n");

    if (!CopyFile(CurrentPath, NewPath, FALSE)) {
        printf("[-] Failed to copy file to destination\n");
        exit(EXIT_FAILURE);
    }

    printf("[+] File copied to destination successfully\n");
}


int main()
{
    TCHAR CurrentPath[MAX_PATH];
    TCHAR NewPath[MAX_PATH];

    GetCurrentFilePath(CurrentPath);
    ConstructNewFilePath(CurrentPath, NewPath);
    CopyFileToDestination(CurrentPath, NewPath);
}

