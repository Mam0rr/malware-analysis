#include <windows.h>
#include <stdio.h>


// Function to generate a seed based on the compile time.
// The seed is guaranteed to be less than 200.
int GenerateCompileTimeSeed(void) {
    // Extract compile time components from __TIME__
    int h = (__TIME__[0] - '0') * 10 + (__TIME__[1] - '0');  // Hours (0-23)
    int m = (__TIME__[3] - '0') * 10 + (__TIME__[4] - '0');  // Minutes (0-59)
    int s = (__TIME__[6] - '0') * 10 + (__TIME__[7] - '0');  // Seconds (0-59)

    // Calculate a seed using a combination of the time components
    int seed = (h * 5 + m * 3 + s) % 200; // Simple weighted sum, ensuring it's less than 200

    return seed;
}

// Function to allocate memory and initialize it with a pseudo-random value.
PVOID AllocateMemoryWithSeed(PVOID* memoryAddress) {
    // Allocate 255 bytes of memory, initializing it to zero
    PVOID allocatedMemory = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, 0xFF);
    if (!allocatedMemory) {
        return NULL; // Return NULL if memory allocation fails
    }

    // Generate a seed and ensure it's less than 200
    int seed = GenerateCompileTimeSeed(); // Generate a random seed

    // Set the first 2 bytes in allocatedMemory to the random number (less than 200)
    *(short*)allocatedMemory = (short)seed; // Store the seed as a 2-byte value

    // Save the base address by pointer and return it
    *memoryAddress = allocatedMemory;
    return allocatedMemory;
}


// Function to simulate importing and using various WinAPI functions.
VOID SimulateWinAPIUsage() {
    PVOID randomMemory = NULL;
    int* randomValue = (int*)AllocateMemoryWithSeed(&randomMemory);

    // This if-statement will never be true
    if (*randomValue > 200) {
        // Dummy function calls to various WinAPI functions
        unsigned __int64 result;
        unsigned __int64 result2;


        result = ShowWindow(NULL, 0);
        result = GetClientRect(NULL, NULL);
        result = InvalidateRect(NULL, NULL, FALSE);
        result = PostMessageW(NULL, 0, 0, 0);
        result = DefWindowProcW(NULL, 0, 0, 0);
        result2 = GetLastError();
        result2 = MessageBeep(NULL);
        
    }

    // Free the memory allocated in 'AllocateRandomMemory'
    HeapFree(GetProcessHeap(), 0, randomMemory);
}

// Main function - entry point of the program.
int main() {
    SimulateWinAPIUsage();
    return 0;
}
